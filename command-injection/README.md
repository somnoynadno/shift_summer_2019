# Command injection

## Описание
Command injection – это атака, основанная на внедрении вредоносного кода в уязвимом приложении. Атаке подвержены сервисы не фильтрующие пользовательский ввод и исполнющие команды операционной системы с помощью функции exec().
[owasp.org](https://www.owasp.org/index.php/Command_Injection)

## Классификация
- Обычная инъекция (результаты атаки видны непосредственно на веб-странице)
- Слепая (blind) инъекция (уязвимое приложение не выводит результаты внедрённой команды. Случается, например, если команда исполняется в отдельном потоке)
- Полуслепая (semi-blind) или файловая инъекция (атакующий не способен наблюдать результаты работы, но может детектировать наличие уязвимости другим способом, например, добавляя в эксплойт команду sleep или пытаясь создать в системе новые файлы и каталоги) 

## Условия
- Характерна для серверных ОС
- Инъекции подвержены практически все языки программирования
- Обязательно наличие функций, обращающихся к операционной системе (e.g. exec() или shell_exec()), в языке программирования, на котором написан сервис
- Атака проходит при отсутсвии или неправильной фильтрации пользовательского ввода

## Детектирование
Проблема детектируется в ходе пентеста, во время проверки полей для пользовательского ввода. Обратить внимание следует на приложения, которые использую bash для выполнения своих функций. Данная уязвимость обнаруживается как автоматически, так и вручную. Код ревью предпочтительнее, так как другой специалист может предложить безопасные варианты реализации функций, исполняемых уязвимым приложением.

Информация:
- в каждый пункт можно добавлять необходимую информацию из статей в ввиде ссылок - [google.com](https://www.google.com)

## Эксплуатация
Здесь необходимо описать пример ручной эксплуатации. Сразу уточните какой это язык, какие компоненты используются, если эксплуатация специфична только для этих условий. Можно записать сюда порядок действий при эксплуатации тестового задания

### Инструменты
-Commix – программа для автоматического поиска возможности внедрения команд ОС. Программу Commix нужно запускать от имени администратора. Нужно указать ключ -u с адресом тестируемого веб-приложения (сайта). Адрес должен содержать переменные, которые будут тестироваться.
Пример команды для данной уязвимоси:
sudo commix -u http://127.0.0.1:1337/?curl=ya.ru
[kali.tools](https://kali.tools/?p=1107)

## Ущерб
- Компроментация файлов на сервере
- Исполнение произвольного кода
- В худшем случае хакер может получить полный контроль над уязвимой системой

## Защита
### Основные меры
Первый способ:
Ограничить допустимые для ввода символы. Привидем список символов, которые следует исключить из ввода. Разделители комманд для Unix и Win:
-&
-&&
-|
-||
Разделители комманд только для Unix систем:
-;
-Newline(0x0a or \n)
-`injected command`
-$injected command
Второй способ:
Найти, если возможно, альтернативный способ реализации функции, которая реализуется за счет обращения к bash. В нашем примере curl можно заменить на stream_context_create и file_get_contents.


### Превентивные меры
А здесь описываем как можем уменьшить ущерб от уязвимости/атаки, если она существует. То есть, подход Defense in Depth.

## Дополнительно
Здесь приложить дополнительную информацию и источники, которые использовали, но не указали выше в других местах.

## Обход защиты
Если существуют варианты обхода защиты, то можно их здесь перечислить.

Если есть возможность, то надо написать в чем заключается защита и каким образом она обходится.
